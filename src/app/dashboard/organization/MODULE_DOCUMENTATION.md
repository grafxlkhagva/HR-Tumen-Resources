# Байгууллагын Бүтэц ба Ажлын Байрны Удирдлагын Модуль

Энэхүү баримт бичиг нь `src/app/dashboard/organization` хавтас доторх Байгууллагын бүтэц (`Department`) болон Ажлын байрны (`Position`) удирдлагын системийн техникийн болон үйл ажиллагааны дэлгэрэнгүй тайлбар юм.

## 1. Ерөнхий Танилцуулга

Энэ модуль нь Хүний нөөцийн системийн суурь хэсэг бөгөөд дараах үндсэн үүргүүдийг гүйцэтгэнэ:
- **Байгууллагын бүтэц**: Газар, хэлтэс, нэгжүүдийг үүсгэх, засах, тэдгээрийн шатлалыг тодорхойлох.
- **Ажлын байрны төлөвлөлт**: Албан тушаалуудыг үүсгэх, ангилах, зэрэглэл тогтоох.
- **Баталгаажуулалт**: Ажлын байрны мэдээллийн бүрдлийг хянаж, батлах (Approval Workflow).
- **Түүх**: Өөрчлөлт болон батламжийн түүхийг хадгалах.

## 2. Файлын Бүтэц ба Зохион байгуулалт

Модуль нь дараах үндсэн бүрэлдэхүүн хэсгүүдтэй:

### 2.1 Үндсэн Хавтасууд
*   `[departmentId]/`: Нэгжийн дэлгэрэнгүй болон удирдлагын хэсэг.
    *   `page.tsx`: Нэгжийн үндсэн хуудас. Ажилчид болон Ажлын байрны жагсаалтыг агуулсан табоудтай.
    *   `components/positions-management-tab.tsx`: Ажлын байрны жагсаалт, олноор батлах үйлдэл, бүтэц зураглал.
    *   `components/position-structure-chart.tsx`: Ажлын байрны шатлалыг харуулах мод бүтэц (Org Chart).
*   `positions/[positionId]/`: Ажлын байрны дэлгэрэнгүй тохиргооны хэсэг.
    *   `page.tsx`: Ажлын байрны дэлгэрэнгүй хуудас.
    *   `components/`:
        *   `position-overview.tsx`: Үндсэн мэдээлэл (Нэр, код, ангилал).
        *   `position-competency.tsx`: Ур чадвар, АБТ файл, үүрэг хариуцлага.
        *   `position-compensation.tsx`: Цалин, урамшуулал.
        *   `position-benefits.tsx`: Хангамж.
        *   `validation-indicator.tsx`: Мэдээллийн бүрдлийг харуулах индикатор.

### 2.2 Shared Components (Дуни бүрэлдэхүүнүүд)
*   `add-position-dialog.tsx`: Ажлын байр шинээр үүсгэх/засах цонх.
*   `components/positions-list-table.tsx`: Ажлын байрны жагсаалт хүснэгт.
*   `types.ts`: TypeScript өгөгдлийн загварууд (`Position`, `Department`, `ApprovalLog` гэх мэт).

## 3. Үндсэн Үйл Ажиллагаа (Features)

### 3.1 Ажлын Байрны Баталгаажуулалт (Validation Logic)
Ажлын байрыг батлахын тулд систем дараах мэдээллүүдийг 100% бөглөсөн байхыг шаарддаг. Үүнд:
1.  **Үндсэн мэдээлэл**: Нэр, Код, Харьяалагдах нэгж, Зэрэглэл, Ангилал, Ажил эрхлэлтийн төрөл, Цагийн хуваарь.
2.  **Чиг үүрэг**: Зорилго, Үүрэг хариуцлага (дор хаяж 1).
3.  **Бичиг баримт**: Ажлын байрны тодорхойлолт (JD) файл хавсаргасан байх.
4.  **Цалин**: Цалингийн шатлал (`mid` point) тохируулсан байх.

**Код:** `validationChecklist` объект нь `useMemo` хук ашиглан реал-тайм тооцоологддог.

### 3.2 Батлах Үйл Явц (Approval Workflow)
*   **Ганцаарчилсан батлах**:
    *   Ажлын байрны дэлгэрэнгүй хуудаснаас "Батлах" товч дарна.
    *   *Шинэчлэл:* Огноо сонгох болон Тэмдэглэл бичих цонх гарч ирнэ.
*   **Олноор батлах (Bulk Action)**:
    *   Нэгжийн удирдлагын хэсгээс олон ажлын байр сонгож батлах боломжтой.
    *   Систем сонгогдсон *бүх* ажлын байрны мэдээлэл бүрэн эсэхийг шалгана.
    *   Хэрэв аль нэг нь дутуу байвал алдааны мэдээлэл (Toast) өгч, батлах үйлдлийг зогсооно.
*   **Түүх (Audit Log)**:
    *   Батлах болон Цуцлах үйлдэл бүр `approvalHistory` талбарт хадгалагдана. ({action, userId, timestamp, note}).

### 3.3 Ажлын Байр Хувилах (Duplicate)
*   Ажлын байрыг хувилах үед бүх мэдээлэл хуулагдах боловч:
    *   `isApproved`: `false` (Батлагдаагүй)
    *   `filled`: `0` (Ажилтангуй)
    *   `title`: `(Хуулбар)` гэсэн дагавар авна.

### 3.4 Бүтэц Харах (Structure Chart)
*   `PositionStructureChart` компонент нь албан тушаалуудын тайлагналын (`reportsTo`) холбоосыг ашиглан мод хэлбэрийн бүтэц зурна.
*   Гүйцэтгэлийн статус, баталгаажсан эсэхийг өнгөөр ялгаж харуулна.

## 4. Техникийн Шийдэл

### 4.1 Өгөгдлийн Сан (Firebase Firestore)
*   **Collections**: `departments`, `positions`, `positionLevels`, `departmentHistory`.
*   **State Updates**: `updateDocumentNonBlocking` ашиглан UI-г гацаахгүйгээр өгөгдлийг шинэчилдэг.

### 4.2 Үндсэн Hook-ууд
*   `useCollection`: Өгөгдлийг татах болон cache хийх.
*   `useMemo`: Тооцоолол ихтэй локигуудыг (Validation, Statistics) оновчлох.

### 4.3 UI Компонентууд
*   Shadcn UI (Cards, Dialogs, Tables, Tabs) ашигласан.
*   TailwindCSS-ээр загварчилсан.
*   `ValidationIndicator`: Мэдээллийн бүрдлийг харуулах тусгай компонент.

---
*Сүүлд шинэчлэгдсэн: 2026-01-11*
